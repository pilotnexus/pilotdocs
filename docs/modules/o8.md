# 8 Digital Output Module

{% module svg="o8.svg" %}
{% endmodule %}

<div id="app">
<div class="dropdown">
    <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">
    <span v-html="configurations[selectedconfiggroup][selectedconfig]['shortdesc']"></span>
    <span class="caret"></span></button>
    <ul class="dropdown-menu">
    <template v-for="(configgroup, key, index) in configurations">
      <li class="dropdown-header" v-html="configgroup.title"></li>
      <template v-for="(config, cfgkey, index) in configgroup">
      <li v-html="config.title" v-on:click="setConfig(key, cfgkey)" class="pin" v-bind:class="{'selected': cfgkey==selectedconfig}"></li>
      </template>
    </template>
    </ul>
</div>

<div class="container">
  <div class="row">
    <div class="col-8">
    <object name="modulesvg" type="image/svg+xml" data="/.gitbook/assets/modules/o8.svg"></object>
  </div>
    <div class="col-4">
    <h3>Pinout</h3>
    <ol>
        <template v-for="(pin, key, index) in pins">
            <li v-html="pin.title" v-on:mouseover="activepin=key" v-on:mouseout="activepin=-1" v-on:click="selectedpin=key" v-bind:class="{'pin active': key==activepin, 'pin selected': key==selectedpin}">
        </template>
      </li>
    </ol>
    </div>
  </div>
</div>

<template v-for="(pin, key, index) in pins">
    <div v-if="selectedpin == key">
        <h3 v-html="pins[key].title"></h3>
        <div v-html="pins[key].description[selectedconfig] ? pins[key].description[selectedconfig] : pins[key].description.default"></div>
    </div>
</template>

</div>

<script>
    //var configJson = "{}"; 
    //$(document).ready(function() {
    //    updatePins();
    //});
    
    var bus = new Vue({});

    var PinComponent = Vue.extend({
    template: `<path v-on:click="emitter('click')" v-on:mouseover="emitter('hover')" v-on:mouseout="emitter('unhover')" v-bind:fill="this.pinnr == $parent.activepin || this.pinnr == $parent.selectedpin ? '#008cff' : 'rgb(153, 153, 153);'"/>`,
    props: ['pinnr', 'activepin', 'selectedpin'],
    methods : {
        emitter: function(ev) {
            bus.$emit(ev,this.pinnr);
            console.log(`ev: ${ev} selectedpin ${this.$parent.selectedpin}, activepin ${this.$parent.activepin}`);
        }
    }
    });

    var app = new Vue({
  el: '#app',
  data: {
        activepin: -1,
        selectedpin: -1,
        selectedconfiggroup: 'external',
        selectedconfig: 'default',
        pins: {
            "1": {title: '5-30V', direction: {default: 'in', v5: 'out', v24: 'out'}, description: {
                default: 'This pin is used to power the module, or draw power from it. Please select a configuration from the dropdown above to get more information about a specific mode.',
                v5: 'In this jumper configuration, power is supplied from the internal 5V rail. You can source 5V from this pin, but keep in mind that current capability is limited',
                v24: ''
            }},
            "2": {title: 'GND', direction: '', description: {
                default: 'Ground Pin.'
            }},
            "3": {title: 'Output 1', direction: { default: 'out' }, description: {default: 'This is an output pin'} },
            "4": {title: 'Output 2', direction: { default: 'out' }, description: {default: 'This is an output pin'} },
            "5": {title: 'Output 3', direction: { default: 'out' }, description: {default: 'This is an output pin'} },
            "6": {title: 'Output 4', direction: { default: 'out' }, description: {default: 'This is an output pin'} },
            "7": {title: 'Output 5', direction: { default: 'out' }, description: {default: 'This is an output pin'} },
            "8": {title: 'Output 6', direction: { default: 'out' }, description: {default: 'This is an output pin'} },
            "9": {title: 'Output 7', direction: { default: 'out' }, description: {default: 'This is an output pin'} },
            "10": {title: 'Output 8', direction: { default: 'out' }, description: {default: 'This is an output pin'} }
        },
        configurations: {
            external: {
                title: 'External Power',
                default: { title: '5-30V', shortdesc: 'External Power Mode'},
            },
            internal: {
                title: 'Internal Power',
                v5: { title: '5V',  shortdesc: 'Internal 5V Power Mode'},
                v24: { title: '24V', shortdesc: 'Internal 24V Power Mode'}
            }
        }
  },
  methods: {
    setConfig: function(cfggroup, config) {
        this.selectedconfiggroup = cfggroup;
        this.selectedconfig = config;
        console.log('config set to ' + config + ' ' + cfggroup);
    // do stuff
    }
  },
  mounted: function() {
    var that = this;
    var obj = document.querySelector('[name="modulesvg"]');
    var replacepaths = function() {
        var doc = obj.getSVGDocument();
        if (doc) {
            let spans =  doc.querySelectorAll("[pin]");
            if (spans) {
                for (let i = 0; i < spans.length; i++) {
                var component = new PinComponent({
                    propsData: { pinnr: spans[i].getAttribute('pin') },
                    parent: that
                }).$mount();
                component.$el.setAttribute("d", spans[i].getAttribute("d"));
                //let pin = el.getAttribute('pin');
                spans[i].parentNode.replaceChild(component.$el, spans[i]);
                }
            }
        }
    } 

    obj.onload = function() {
        replacepaths.call(that);
    }
    
    bus.$on('click',(pin) => {
        that.selectedpin = pin;
    });
    bus.$on('hover',(pin) => {
        that.activepin = pin;
    });
    bus.$on('unhover',(pin) => {
        that.activepin = -1;
    });

  },
  /*
  mounted: function() {
    let obj = document.querySelector('[name="modulesvg"]');
    if (obj) {
        var doc = obj.getSVGDocument();
        if (doc) {
            let spans =  doc.querySelectorAll("[pin]");
            if (spans) {
                for (let i = 0; i < spans.length; i++) {
                let el = spans[i];
                let pin = el.getAttribute('pin');
                el.addEventListener('click', () => { this.click(pin); } );
                el.addEventListener('mouseover', () => { this.hover(pin); });
                el.addEventListener('mouseout', () => { this.unhover(pin); });
                }
            }
        }
    }
  }
    */
})

</script>